<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <title>Painel do Administrador - Corretoras Brasil</title>
    <link rel="stylesheet" href="styles.css">

    <style>
        .admin-wrapper {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 16px;
        }

        .admin-card {
            width: 100%;
            max-width: 720px;
            background: #020617;
            border-radius: 20px;
            border: 1px solid var(--cor-borda);
            box-shadow: var(--sombra-card);
            padding: 20px 22px 24px;
        }

        .linha-form-admin {
            display: grid;
            grid-template-columns: repeat(3, minmax(0, 1fr));
            gap: 10px;
            margin-bottom: 8px;
        }

        @media (max-width: 720px) {
            .linha-form-admin {
                grid-template-columns: 1fr;
            }
        }

        /* Upload */
        .upload-wrapper {
            margin-top: 8px;
            margin-bottom: 10px;
        }

        .upload-btn {
            background: #1d4ed8;
            color: #fff;
            padding: 10px 14px;
            border-radius: 8px;
            cursor: pointer;
            display: inline-block;
            transition: 0.2s;
        }

        .upload-btn:hover {
            opacity: 0.8;
        }

        .upload-info {
            margin-left: 10px;
            color: #9ca3af;
            font-size: 13px;
        }

        .preview-fotos {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 10px;
        }

        .preview-fotos img {
            width: 80px;
            height: 80px;
            object-fit: cover;
            border-radius: 6px;
            border: 1px solid #334155;
        }
    </style>
</head>

<body>

    <header class="topo">
        <div class="container topo-conteudo">
            <div class="logo">
                <span class="logo-icone">üè†</span>
                <div class="logo-textos">
                    <h1>Corretoras Brasil</h1>
                    <p>Painel do administrador</p>
                </div>
            </div>

            <a href="index.html" class="btn-secundario">‚Üê Voltar</a>
        </div>
    </header>

    <div class="admin-wrapper">
        <div class="admin-card">

            <!-- LOGIN -->
            <div id="telaLogin">
                <h1>Login</h1>
                <p>Informe a senha para acessar o painel.</p>

                <form id="formLogin" class="campo">
                    <label for="senhaAdmin">Senha</label>
                    <input type="password" id="senhaAdmin" required placeholder="Senha do painel">

                    <button class="btn-primario" style="margin-top: 12px;">Entrar</button>
                </form>
            </div>

            <!-- PAINEL -->
            <div id="telaPainel" style="display:none;">
                <h1>Novo an√∫ncio</h1>
                <p>Preencha os dados e selecione as fotos.</p>

                <form id="formAdmin">

                    <div class="linha-form-admin">
                        <div class="campo">
                            <label>T√≠tulo</label>
                            <input id="tituloAdmin" type="text" required>
                        </div>

                        <div class="campo">
                            <label>Neg√≥cio</label>
                            <select id="tipoNegocioAdmin" required>
                                <option value="">Selecione</option>
                                <option value="venda">Venda</option>
                                <option value="aluguel">Aluguel</option>
                            </select>
                        </div>

                        <div class="campo">
                            <label>Im√≥vel</label>
                            <select id="tipoImovelAdmin" required>
                                <option value="">Selecione</option>
                                <option value="casa">Casa</option>
                                <option value="apartamento">Apartamento</option>
                                <option value="kitnet">Kitnet</option>
                                <option value="terreno">Terreno</option>
                                <option value="sala_comercial">Sala comercial</option>
                            </select>
                        </div>
                    </div>

                    <div class="linha-form-admin">
                        <div class="campo">
                            <label>Pre√ßo</label>
                            <input id="precoAdmin" type="number" min="0" required>
                        </div>

                        <div class="campo">
                            <label>Cidade</label>
                            <input id="cidadeAdmin" type="text" required>
                        </div>

                        <div class="campo">
                            <label>Bairro</label>
                            <input id="bairroAdmin" type="text" required>
                        </div>
                    </div>

                    <div class="linha-form-admin">
                        <div class="campo">
                            <label>Quartos</label>
                            <input id="quartosAdmin" type="number">
                        </div>

                        <div class="campo">
                            <label>Banheiros</label>
                            <input id="banheirosAdmin" type="number">
                        </div>

                        <div class="campo">
                            <label>Vagas</label>
                            <input id="vagasAdmin" type="number">
                        </div>
                    </div>

                    <div class="campo">
                        <label>Descri√ß√£o</label>
                        <textarea id="descricaoAdmin" rows="4"></textarea>
                    </div>

                    <div class="campo">
                        <label>WhatsApp do cliente</label>
                        <input id="whatsAdmin" type="tel" required placeholder="DDD + n√∫mero">
                    </div>

                    <!-- NOVO SISTEMA DE UPLOAD -->
                    <div class="campo">
                        <label>Fotos do im√≥vel</label>

                        <div class="upload-wrapper">
                            <label for="uploadFotos" class="upload-btn">üì∏ Selecionar fotos</label>
                            <span id="uploadInfo" class="upload-info">Nenhuma foto</span>

                            <input type="file" id="uploadFotos" accept="image/*" multiple hidden>
                            <div id="previewFotos" class="preview-fotos"></div>
                        </div>
                    </div>

                    <div class="campo">
                        <label>
                            <input type="checkbox" id="destaqueAdmin">
                            Destaque
                        </label>
                    </div>

                    <div class="acoes-form">
                        <button type="reset" class="btn-secundario">Limpar</button>
                        <button type="submit" class="btn-primario">Salvar</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
        const SENHA_CORRETA = "Jad123456789son@";

        const login = document.getElementById("telaLogin");
        const painel = document.getElementById("telaPainel");

        document.getElementById("formLogin").addEventListener("submit", (e) => {
            e.preventDefault();
            if (document.getElementById("senhaAdmin").value === SENHA_CORRETA) {
                login.style.display = "none";
                painel.style.display = "block";
            } else {
                alert("Senha incorreta.");
            }
        });

        // Upload de fotos
        const inputFotos = document.getElementById("uploadFotos");
        const preview = document.getElementById("previewFotos");
        const info = document.getElementById("uploadInfo");

        inputFotos.addEventListener("change", () => {
            preview.innerHTML = "";

            const arquivos = Array.from(inputFotos.files).slice(0, 10);
            info.textContent = arquivos.length + " foto(s)";

            arquivos.forEach(arq => {
                const leitor = new FileReader();
                leitor.onload = e => {
                    const img = document.createElement("img");
                    img.src = e.target.result;
                    preview.appendChild(img);
                };
                leitor.readAsDataURL(arq);
            });
        });

        document.getElementById("formAdmin").addEventListener("submit", async (e) => {
            e.preventDefault();

            const arquivos = Array.from(inputFotos.files);
            const fotosBase64 = await Promise.all(
                arquivos.map(arq => new Promise(resolve => {
                    const r = new FileReader();
                    r.onload = e => resolve(e.target.result);
                    r.readAsDataURL(arq);
                }))
            );

            const novo = {
                id: Date.now(),
                titulo: tituloAdmin.value.trim(),
                tipoNegocio: tipoNegocioAdmin.value,
                tipoImovel: tipoImovelAdmin.value,
                preco: Number(precoAdmin.value),
                cidade: cidadeAdmin.value.trim(),
                bairro: bairroAdmin.value.trim(),
                quartos: Number(quartosAdmin.value),
                banheiros: Number(banheirosAdmin.value),
                vagas: Number(vagasAdmin.value),
                descricao: descricaoAdmin.value.trim(),
                whatsapp: whatsAdmin.value.trim(),
                destaque: destaqueAdmin.checked,
                fotos: fotosBase64
            };

            try {
                const resp = await fetch("http://72.60.152.220:6001/adicionar", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify(novo)
                });

                const data = await resp.json();

                if (data.status === "ok") {
                    alert("Im√≥vel salvo com sucesso!");
                    location.reload();
                } else {
                    alert("Erro ao salvar no servidor.");
                }
            } catch (err) {
                alert("Falha ao conectar ao servidor.");
                console.error(err);
            }
        });
    </script>
</body>

</html>
